# Gemini CLI Allow Policies
# Mirrors Claude Code permissions from .claude/hooks/allow_commands.sh
# Uses aggressive regex consolidation for maintainability

# 1. Ruby/Rails commands
# * accept: standalone, binstubs or bundle exec
[[rule]]
toolName = "run_shell_command"
argsPattern = '"command":"(bundle exec |bin/)?(brakeman|bundler-audit|rspec|rubocop|rake|rails|ruby -Itest)'
decision = "allow"
priority = 150

# 2. Bundle read-only commands
[[rule]]
toolName = "run_shell_command"
argsPattern = '"command":"bundle (config|show|outdated|platform|help|check|doctor|version)'
decision = "allow"
priority = 150

# 3. Gem read-only commands
[[rule]]
toolName = "run_shell_command"
argsPattern = '"command":"gem (help|list|env|open|outdated|specification|stale|which)'
decision = "allow"
priority = 150

# 4. Yarn read-only commands
[[rule]]
toolName = "run_shell_command"
argsPattern = '"command":"yarn (list|why|info|versions|config list)'
decision = "allow"
priority = 150

# 5. Homebrew read-only commands
[[rule]]
toolName = "run_shell_command"
argsPattern = '"command":"brew (list|info|leaves|doctor|config|search|help)'
decision = "allow"
priority = 150

# 6. Git read-only commands
[[rule]]
toolName = "run_shell_command"
argsPattern = '"command":"git (blame|check-ignore|config get|diff|grep|log|ls-files|show|status)'
decision = "allow"
priority = 150

# 6b. GitHub CLI (read-only + bounded mutations)
[[rule]]
toolName = "run_shell_command"
argsPattern = '"command":"gh (issue|pr|repo) (view|list|status|diff|checks)'
decision = "allow"
priority = 150

[[rule]]
toolName = "run_shell_command"
argsPattern = '"command":"gh issue (edit|develop)'
decision = "allow"
priority = 150

[[rule]]
toolName = "run_shell_command"
argsPattern = '"command":"gh pr create'
decision = "allow"
priority = 150

# 7. Utility commands (read-only)
[[rule]]
toolName = "run_shell_command"
commandPrefix = ["col", "column", "cut", "date", "diff", "echo", "grep", "head", "jaq", "jq", "man", "nl", "pgrep", "printenv", "ps", "rg", "tail", "test", "tr", "uname", "wc"]
decision = "allow"
priority = 150

# 7b. File/path utilities (read-only)
[[rule]]
toolName = "run_shell_command"
commandPrefix = ["basename", "cat", "df", "dirname", "du", "file", "ls", "pwd", "readlink", "realpath", "stat", "tree", "type", "which"]
decision = "allow"
priority = 150

# 7c. Directory management
[[rule]]
toolName = "run_shell_command"
commandPrefix = ["mkdir"]
decision = "allow"
priority = 150

# 8. Commands with dangerous flags (ask policies block unsafe forms)
[[rule]]
toolName = "run_shell_command"
argsPattern = '"command":"(find|fd|sort|git branch)( |$)'
decision = "allow"
priority = 150

# 9. Shell introspection (exact commands only)
[[rule]]
toolName = "run_shell_command"
argsPattern = '"command":"(complete -p|command -v|env)"}'
decision = "allow"
priority = 150

# 10. Web fetch for Ruby/Rails documentation
[[rule]]
toolName = "web_fetch"
argsPattern = "(docs\\.claude\\.com|api\\.rubyonrails\\.org|docs\\.ruby-lang\\.org|hotwired\\.dev|masilotti\\.com|betterspecs\\.org|rubydoc\\.info|thoughtbot\\.com|rubygems\\.org)"
decision = "allow"
priority = 150
